<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kean Rock Paper Scissors</title>
  </head>
  <body>
    <p>Rock Paper Scissors</p>
    <button onclick="playGame('rock');">Rock</button>
    <button onclick="playGame('paper');">Paper</button>
    <button onclick="playGame('scissors');">Scissors</button>
    <p class="js-result"></p>
    <p class="js-moves"></p>
    <p class="js-score"></p>
    <button onclick="resetScore();">Reset Score</button>
    <p class="js-reset"></p>
  </body>
  <script>
    let score = JSON.parse(localStorage.getItem("score")) || {
      wins: 0,
      losses: 0,
      ties: 0,
    };
    let scoreEl = document.querySelector(".js-score");
    updateScoreEl();

    function pickComputerMove() {
      const ranNum = Math.floor(Math.random() * 3) + 1;
      let computerMove = "";
      if (ranNum === 1) {
        computerMove = "rock";
      } else if (ranNum === 2) {
        computerMove = "paper";
      } else if (ranNum === 3) {
        computerMove = "scissors";
      }
      return computerMove;
    }
    function getResult(userSelection, computerMove) {
      let result = "";

      if (userSelection === computerMove) {
        result = "Tie.";
        score.ties += 1;
      } else if (
        (userSelection === "rock" && computerMove === "scissors") ||
        (userSelection === "paper" && computerMove === "rock") ||
        (userSelection === "scissors" && computerMove === "paper")
      ) {
        result = "You win.";
        score.wins += 1;
      } else {
        result = "You lose.";
        score.losses += 1;
      }

      localStorage.setItem("score", JSON.stringify(score));

      return result;
    }
    function playGame(userSelection) {
      const computerMove = pickComputerMove();
      const result = getResult(userSelection, computerMove);
      const storedScore = JSON.parse(localStorage.getItem("score"));

      const resultEl = document.querySelector(".js-result");
      const movesEl = document.querySelector(".js-moves");

      resultEl.textContent = result;
      movesEl.textContent = `You picked ${userSelection} VS  ${computerMove} picked by Computer`;
      updateScoreEl();
    }

    function resetScore() {
      const resetEl = document.querySelector(".js-reset");

      let isScoreEmpty = Object.entries(score).every((s) => s[1] <= 0);

      localStorage.removeItem("score");
      updateScoreEl();

      console.log(isScoreEmpty);

      if (!isScoreEmpty) {
        resetEl.textContent = "Score reset.";
        setTimeout(() => (resetEl.textContent = ""), 1000);
      }
    }

    function updateScoreEl() {
      scoreEl.textContent = `Wins: ${score.wins}, Losses: ${score.losses}, Ties: ${score.ties}`;
    }
  </script>
</html>
